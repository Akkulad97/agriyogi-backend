<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AgriYogi - Farm Blockchain</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body class="bg-light">
    <!-- Header -->
    <nav class="navbar navbar-dark bg-gradient sticky-top shadow-sm">
      <div class="container-fluid">
        <span class="navbar-brand mb-0 h5">
          <img src="/static/logo.jpg" class="brand-logo me-2" alt="AgriYogi logo"/>
          AgriYogi - Farm Ledger
        </span>
        <div id="headerUser" class="text-white fs-6"></div>
      </div>
    </nav>

    <div class="container-lg py-5">
      <div id="verifyBanner" class="alert alert-info d-none mb-4"></div>
      <!-- Main Grid -->
      <div class="row g-4">
        <div class="col-12">
          <div class="tagline">Organic farm record, built for growers, farmers and inspectors.</div>
        </div>
        <!-- Left: Blockchain Viewer -->
        <div class="col-lg-7">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-gradient text-white border-0 py-3">
              <h5 class="mb-0"><i class="bi bi-diagram-3"></i> Crop Ledger</h5>
            </div>
            <div class="card-body p-0">
              <div class="filter-bar">
                <div class="row g-2 align-items-center">
                  <div class="col-md-6">
                    <input id="searchInput" class="form-control" placeholder="Search activity, author, or hash" />
                  </div>
                  <div class="col-md-4">
                    <select id="categoryFilter" class="form-select">
                      <option value="All">All categories</option>
                      <option>Planting</option>
                      <option>Watering</option>
                      <option>Fertilizing</option>
                      <option>Weeding</option>
                      <option>Harvest</option>
                      <option>Soil</option>
                      <option>Pest Control</option>
                      <option>Other</option>
                    </select>
                  </div>
                  <div class="col-md-2 d-grid">
                    <button id="clearFilters" class="btn btn-outline-secondary">Clear</button>
                  </div>
                </div>
              </div>
              <div id="chain" class="chain-viewer"></div>
            </div>
          </div>
        </div>

        <!-- Right: Controls & Info -->
        <div class="col-lg-5">
          <!-- Auth Card -->
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-gradient text-white border-0 py-3">
              <h5 class="mb-0"><i class="bi bi-lock"></i> Account</h5>
            </div>
            <div class="card-body" id="userInfo">
              <form id="loginForm">
                <div class="mb-3">
                  <input id="loginUser" class="form-control form-control-lg" placeholder="Farm Username" required />
                </div>
                <div class="mb-3">
                  <input id="loginPass" type="password" class="form-control form-control-lg" placeholder="Password" required />
                </div>
                <div class="d-grid gap-2 mb-2">
                  <button class="btn btn-primary btn-lg" type="submit"><i class="bi bi-box-arrow-in-right"></i> Login</button>
                </div>
                <p class="text-center mb-0"><button id="showRegister" class="btn btn-link" type="button">New to AgriYogi? Sign Up</button></p>
              </form>
              <form id="registerForm" style="display:none;">
                <div class="mb-3">
                  <input id="regUser" class="form-control form-control-lg" placeholder="Choose Username" required />
                </div>
                <div class="mb-3">
                  <input id="regPass" type="password" class="form-control form-control-lg" placeholder="Choose Password" required />
                </div>
                <div class="d-grid gap-2 mb-2">
                  <button class="btn btn-success btn-lg" type="submit"><i class="bi bi-person-plus"></i> Register</button>
                </div>
                <p class="text-center mb-0"><button id="showLogin" class="btn btn-link" type="button">Back to Login</button></p>
              </form>
              <div id="loggedIn" style="display:none;">
                <div class="alert alert-success mb-3 text-center">
                  <i class="bi bi-check-circle"></i> Logged in as <strong id="currentUser"></strong>
                </div>
                <div class="d-grid gap-2">
                  <button id="logoutBtn" class="btn btn-outline-danger"><i class="bi bi-box-arrow-right"></i> Logout</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Mine Block Card -->
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-gradient text-white border-0 py-3">
              <h5 class="mb-0"><i class="bi bi-sprout"></i> Record Activity</h5>
            </div>
            <div class="card-body">
              <form id="mineForm">
                <div class="mb-3">
                  <label class="form-label fw-bold">Farm Activity</label>
                  <div class="template-row mb-2">
                    <span class="text-muted small">Templates:</span>
                    <button type="button" class="btn btn-sm btn-outline-success template-btn" data-template="Planting">Planting</button>
                    <button type="button" class="btn btn-sm btn-outline-success template-btn" data-template="Watering">Watering</button>
                    <button type="button" class="btn btn-sm btn-outline-success template-btn" data-template="Fertilizing">Fertilizing</button>
                    <button type="button" class="btn btn-sm btn-outline-success template-btn" data-template="Harvest">Harvest</button>
                  </div>
                  <textarea id="dataInput" class="form-control" placeholder="Record activity: planting, watering, fertilizing, harvesting..." rows="3" required></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label fw-bold">Activity Photo</label>
                  <input id="photoInput" type="file" class="form-control" accept="image/*" />
                  <small class="text-muted">Optional: attach a photo to verify the activity</small>
                </div>
                <div class="mb-3">
                  <label class="form-label fw-bold">Verified By</label>
                  <input id="verifiedByInput" type="text" class="form-control" placeholder="e.g., Farm Manager, Auditor Name" />
                  <small class="text-muted">Optional: who verified this activity</small>
                </div>
                <div class="d-grid gap-2 mb-2">
                  <button class="btn btn-success btn-lg" type="submit"><i class="bi bi-plus-circle"></i> Record Activity</button>
                </div>
                <button id="clearBtn" class="btn btn-outline-secondary w-100" type="button"><i class="bi bi-x-circle"></i> Clear</button>
                <div class="mt-2">
                  <button id="scanBtn" class="btn btn-outline-primary w-100 mt-2" type="button"><i class="bi bi-camera"></i> Scan QR</button>
                </div>
                <div id="qrScannerContainer" style="display:none; margin-top:12px;">
                  <div id="qrScanner" style="width:100%;"></div>
                  <div class="mt-2 d-grid"><button id="stopScanBtn" class="btn btn-danger">Stop Scan</button></div>
                </div>
              </form>
            </div>
          </div>

          <!-- Verification Card -->
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-gradient text-white border-0 py-3">
              <h5 class="mb-0"><i class="bi bi-shield-check"></i> Verification</h5>
            </div>
            <div class="card-body">
              <p class="text-muted mb-3">Check the integrity and validity of all blocks in the chain.</p>
              <div class="d-grid gap-2">
                <button id="verifyBtn" class="btn btn-info btn-lg"><i class="bi bi-lightning-charge"></i> Verify Chain</button>
              </div>
              <div id="verifyResults" class="mt-3" style="display:none;"></div>
            </div>
          </div>

          <!-- QR Codes Card -->
          <div class="card shadow-sm border-0">
            <div class="card-header bg-gradient text-white border-0 py-3">
              <h5 class="mb-0"><i class="bi bi-qr-code"></i> QR Codes</h5>
            </div>
            <div class="card-body text-center">
              <div class="mb-3">
                <p class="text-muted mb-2">Site URL</p>
                <img id="siteQr" src="/qr" alt="site-qr" class="qr-code"/>
              </div>
              <div>
                <p class="text-muted mb-2">Latest Block</p>
                <img id="blockQr" src="/qr?text=" alt="block-qr" class="qr-code"/>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
    <script src="/static/script.js"></script>
  </body>
</html>
